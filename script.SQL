CREATE TABLE USER (
    ID_USER INTEGER PRIMARY KEY AUTO_INCREMENT,
    USER_NAME VARCHAR(150) UNIQUE,
    SENHA VARCHAR(200) CHECK (LENGTH(SENHA) > 6),
    CONTATO1 VARCHAR(200),
    CONTATO2 VARCHAR(200),
    ESTADO VARCHAR(100),
    CIDADE VARCHAR(100),
    BAIRRO VARCHAR(100),
    RUA VARCHAR(100),
    NUMERO VARCHAR(10),
    COMPLEMENTO VARCHAR(100)
);

CREATE TABLE MESTRE (
	FK_ID_USER INTEGER PRIMARY KEY,
	NPC VARCHAR(300),
	MONSTRO VARCHAR(300),
	FOREIGN KEY(FK_ID_USER) REFERENCES USER(ID_USER)
);

CREATE TABLE JOGADOR (
	FK_ID_USER INTEGER PRIMARY KEY,
	FOREIGN KEY(FK_ID_USER) REFERENCES USER(ID_USER)
);


CREATE TABLE PERSONAGEM (
    ID_PERSONAGEM INTEGER PRIMARY key AUTO_INCREMENT,
    NOME VARCHAR(100),
    CLASSE VARCHAR(50),
    NIVEL INTEGER,
    HABILIDADES VARCHAR(1000),
    BACKSTORY VARCHAR(3000),
    FK_ID_JOGADOR INTEGER,
    FOREIGN KEY (FK_ID_JOGADOR) REFERENCES JOGADOR(FK_ID_USER) ON DELETE CASCADE
);


CREATE TABLE HISTORIA (
    ID_HISTORIA INTEGER PRIMARY KEY,
    NOME VARCHAR (100),
    PROLOGO VARCHAR (2000),
    QTD_JOGADORES INTEGER,
    DT_INICIO DATE,
    PRESENCIAL BOOL DEFAULT FALSE,
    FK_ID_MESTRE INTEGER,
    # Caso um mestre seja deletado, todas as suas histórias são deletadas também
    FOREIGN KEY (FK_ID_MESTRE) REFERENCES MESTRE (FK_ID_USER) ON DELETE CASCADE
);	


CREATE TABLE PARTICIPACAO (
	FK_ID_PERSONAGEM INTEGER,
	FK_ID_MESTRE INTEGER,
	FK_ID_HISTORIA INTEGER,
	PRIMARY KEY(FK_ID_PERSONAGEM, FK_ID_MESTRE, FK_ID_HISTORIA),
	FOREIGN KEY (FK_ID_PERSONAGEM) REFERENCES PERSONAGEM (ID_PERSONAGEM),
	FOREIGN KEY (FK_ID_MESTRE, FK_ID_HISTORIA) REFERENCES HISTORIA (FK_ID_MESTRE, ID_HISTORIA)
);

CREATE TABLE PRODUTO (
	ID_PRODUTO INTEGER PRIMARY KEY,
	NOME_PRODUTO VARCHAR(100),
	DESCRICAO VARCHAR(500),
	PRECO DOUBLE
);

CREATE TABLE DADO (
	ID_DADO INTEGER PRIMARY KEY,
	QTD_LADOS INTEGER,
	FOREIGN KEY (ID_DADO) REFERENCES PRODUTO (ID_PRODUTO)
);

ALTER TABLE DADO
RENAME COLUMN ID_DADO TO FK_ID_PRODUTO;

CREATE TABLE LIVRO (
	ID_LIVRO INTEGER PRIMARY KEY,
	QTD_PAGINAS INTEGER,
	ESTADO DOUBLE,
	FOREIGN KEY (ID_LIVRO) REFERENCES PRODUTO (ID_PRODUTO)
);

ALTER TABLE LIVRO
RENAME COLUMN ID_LIVRO TO FK_ID_PRODUTO;

CREATE TABLE VENDA (
    ID_VENDA INTEGER PRIMARY KEY,
    ID_PRODUTO INTEGER,
    ID_USER INTEGER,
    DATA_VENDA DATE,
    FOREIGN KEY (ID_PRODUTO) REFERENCES PRODUTO(ID_PRODUTO),
    FOREIGN KEY (ID_USER) REFERENCES USER(ID_USER)
);

ALTER TABLE VENDA
RENAME COLUMN ID_PRODUTO TO FK_ID_PRODUTO;

ALTER TABLE VENDA
RENAME COLUMN ID_USER TO FK_ID_USER;

CREATE TABLE COMPRA (
    ID_COMPRA INTEGER PRIMARY KEY,
    ID_PRODUTO INTEGER,
    ID_USER INTEGER,
    DATA_COMPRA DATE,
    FOREIGN KEY (ID_PRODUTO) REFERENCES PRODUTO(ID_PRODUTO),
    FOREIGN KEY (ID_USER) REFERENCES USER(ID_USER)
);

ALTER TABLE COMPRA
RENAME COLUMN ID_PRODUTO TO FK_ID_PRODUTO;

ALTER TABLE COMPRA
RENAME COLUMN ID_USER TO FK_ID_USER;
